# Testing duplicty

## Introduction
Duplicitys test concept bases on unit test. 
All tests are contained in the /testing folder of the main repository. 

As to see in the following sketch, here are several levels of testing duplicity and each can be used directly.

                                    ┌─────────────────────┐     
                                    │    docker image     │     
                                    ├─────────────────────┴────┐
                                    │                          │
                                    │  ┌──────────────────┐    │
                                    │  │       tox        │    │
                                    │  └──────────────────┘    │
                                    │            │             │
                                    │            ▼             │
                                    │  ┌──────────────────┐    │
                                    │  │    unittests     │    │
                                    │  └──────────────────┘    │
                                    │            │             │
                                    │            ▼             │
                                    │  ┌──────────────────┐    │
                                    │  │    duplicity     │    │
                                    │  └──────────────────┘    │
                                    │                          │
                                    └──────────────────────────┘
1. Directly using __setup.py__
Assuming that your machine has all the required dependencies installed, you can start all the unit tests by simply typing

‘setup.py test‘ 

One can also execute single tests of the whole set of test cases by typing

TBD


2. Using __tox__
Tox is a generic virtualenv management and test command line tool that is used for checking your package installs correctly with different Python versions and interpreters. It 
runs the tests in each of the environments that are configured in the tox.ini file (see root folder of the repository)

A tox run can be started simply by typing 

‘tox‘

from the duplicity folder. 

One can also execute single tests of the whole set of test cases by typing

TBD


3. Via the __docker__ image 
Testing on a developer's machine can be tricky. Testing duplicity requires a set of dependencies being installed and reacts sensitiviely to changes of the local python configuration. In order to make sure that such interactions do not pose any influence on executing the tests, docker is the technology of choice. 
Along with the tests, a docker image has been created (cf. Dockerfile in root folder of repo) that ensure the following things:
- It bases on a clean Ubunut 16.04
- It installs all the required packages that are needed for testing
- It then branches the repository of duplicty to the folder /testing within the dokcer image
- And installs all the required python packages (as defined in the requirements.txt)
Therewith, the docker image provides a clean and reproducible environment for executing the tests of duplicty. 
In order to get hands on the docker image you simply: 
1) Install Docker on your machine (https://docs.docker.com/engine/installation/)
2) Start the image docker run -it dernils/duplicitytest /bin/bash (if you did not use the image before, it will be downloaded automatically)
3) At the prompt of the docker image type:
‘cd /testing‘
‘tox‘ 

## Dependencies for testing
If you should prefer to execute the tests locally without using docker, the Dockerfile that is checked into the root folder of the repository contains useful information. It contains a section marked "The following packages are needed for testing duplicity". Within this section all dependencies that need to be installed on a machine to execute the test cases are identified. 

## Working with test coverage
Python makes it easy to determine, how well the tests cover the source code. 

You first run the tests __under observation__ of the coverage script:
‘coverage run setup.py test‘
After that, a report can be generated by the use of the command:
‘coverage html --omit="testing/*,/usr/*"‘

The report will be generated and stored in the folder htmlcov. 




